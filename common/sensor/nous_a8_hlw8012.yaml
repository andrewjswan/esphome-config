platform: hlw8012
model: BL0937
sel_pin:
  number: GPIO14
  inverted: True
cf_pin: GPIO27
cf1_pin: GPIO26
change_mode_every: 1
current_resistor: ${current_res}
voltage_divider: ${voltage_div}
update_interval: 5s

current:
  name: "Current"
  unit_of_measurement: A
  accuracy_decimals: 3
  # icon: mdi:current-ac
  device_class: current
  filters:
    # Furthermore it corrects ${amperage_min}A for the power usage of the plug.
    - lambda: if (x <= ${amperage_min}) return 0; else return x;
  web_server:
    sorting_weight: 10
    sorting_group_id: sorting_group_power

voltage:
  name: "Voltage"
  unit_of_measurement: V
  accuracy_decimals: 1
  # icon: mdi:flash-outline
  device_class: voltage
  web_server:
    sorting_weight: 15
    sorting_group_id: sorting_group_power

power:
  name: "Power"
  unit_of_measurement: W
  id: power
  # icon: mdi:gauge
  device_class: power
  accuracy_decimals: 1
  filters:
    - calibrate_linear:
        - 0.0 -> 0.0
        - 24.50 -> 28.40
    # Make everything below ${wattage_min}W appear as just 0W.
    - lambda: if (x <= ${wattage_min}) return 0; else return x;
  on_value_range:
    - above: ${max_power}
      then:
        - switch.turn_off: relay
        - binary_sensor.template.publish:
            id: overpowering
            state: ON
  web_server:
    sorting_weight: 5
    sorting_group_id: sorting_group_power
